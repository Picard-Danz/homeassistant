#################################################################
## Desktop Clock Automations
#################################################################

  ##########################################################
  ## USER1's Office
  ##########################################################

      ##########################################################
      ## Turn On USER1 Office Desktop Clock when Motion Detected
      ##########################################################

- alias: Desktop Clock - Turn On USER1's Office when Motion Detected
  id: 'desktop_clock_turn_on_USER1_office_when_motion_detected'

  trigger:
    - platform: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: light.turn_on
      entity_id:
        - light.USER1s_office_desktop_clock

      ##########################################################
      ## Turn Off USER1 Office Desktop Clock when No Motion Detected
      ##########################################################

- alias: Desktop Clock - Turn Off USER1's Office when No Motion Detected
  id: 'desktop_clock_turn_off_USER1_office_when_no_motion_detected'

  trigger:
    - platform: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 20
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: light.turn_off
      entity_id:
        - light.USER1s_office_desktop_clock

      ##########################################################
      ## USER1's Office Desktop Clock Weather
      ##########################################################

- alias: Desktop Clock - USER1's Office Desktop Clock Weather
  id: 'desktop_clock_USER1_office_weather'

  trigger:
    - platform: time_pattern
      minutes: '/15'

  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/weather
        payload: >-
          { 
          "icon": "weather_{{ states("weather.REDACTED") |regex_replace(find='-', replace='_', ignorecase=False) }}",
          "pushIcon": 2,
          "text": "{{ states("weather.REDACTED") }}"
          }

      ##########################################################
      ## USER1's Office Desktop Clock Temperature
      ##########################################################

- alias: Desktop Clock - USER1's Office Temperature
  id: 'desktop_clock_USER1_office_temperature'

  trigger:
    - platform: time_pattern
      minutes: '/15'

  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/temperature
        payload: >-
          { 
          "icon": "temp",
          "pushIcon": 0,
          "text": "{{ states("sensor.REDACTED_temperature") }}Â°F"
          }

      ##########################################################
      ## MK3 3D Print Progress USER1's Office Dekstop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office MK3 3D Print Progress
  id: 'desktop_clock_USER1_office_mk3_3dprint_progress'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_progress
  
  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sensor.prusa_mk3_status
      state: 'Printing'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 2,
          "color": [255,165,0],
          "text": "MK3 Print {{ states("sensor.prusa_mk3_progress") }}% Complete"
          }

      ##########################################################
      ## MK3 3D Print Time Remaining USER1's Office Dekstop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office MK3 3D Print Time Remaining
  id: 'desktop_clock_USER1_office_mk3_3dprint_print_time_remain'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_print_finish
  
  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sensor.prusa_mk3_status
      state: 'Printing'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_time_remaining
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,165,0],
          "text": "MK3 Print {{ states("sensor.prusa_mk3_print_finish") }} Remaining"
          }

       ##########################################################
       ## Mini 3D Print Progress USER1's Office Dekstop Clock
       ##########################################################

- alias: Desktop Clock - USER1's Office Mini 3D Progress Status
  id: 'desktop_clock_USER1_office_mini_3dprint_progress'
  
  trigger:
    - platform: state
      entity_id: sensor.prusamini_progress
  
  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sensor.prusamini
      state: 'printing'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mini_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 2,
          "color": [255,165,0],
          "text": "MINI Print {{ states("sensor.prusamini_progress") }}% Complete"
          }

      ##########################################################
      ## Mini 3D Print Time Remaining USER1's Office Dekstop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Mini 3D Print Time Remaining
  id: 'desktop_clock_USER1s_office_mini_3dprint_time_remain_USER1_office'
  
  trigger:
    - platform: state
      entity_id: sensor.prusamini_progress
  
  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sensor.prusamini
      state: 'printing'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mini_progress
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,165,0],
          "text": "MINI Print {{ relative_time(now() - timedelta( seconds = as_timestamp(states('sensor.prusamini_print_finish')) - as_timestamp(now()))) }} Remaining"
          }

      ##########################################################
      ## MK3 3D Print Complete USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office MK3 3D Print Complete
  id: 'desktop_clock_USER1_office_mk3_3d_print_complete'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_status
      from: 'Printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_complete
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 2,
          "rainbow": true,
          "text": "MK3 Print Complete"
          }

      ##########################################################
      ## Mini 3D Print Complete USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Mini 3D Print Complete
  id: 'desktop_clock_USER1_office_mini_3d_print_complete'

  trigger:
    - platform: state
      entity_id: sensor.prusamini
      from: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mini_complete
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 2,
          "rainbow": true,
          "text": "MINI Print Complete"
          }


      ##########################################################
      ## Doorbell USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - Doorbell USER1's Office
  id: 'desktop_clock_doorbell_USER1_office'

  trigger:
    - platform: state
      entity_id: binary_sensor.ring_front_door_ding
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "doorbell",
          "pushIcon": 0,
          "duration": 30,
          "textCase": 0,
          "text": "Doorbell"
          }

      ##########################################################
      ## Do Not Disturb On USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1 Office Do Not Disturb On
  id: 'desktop_clock_USER1_office_do_not_disturb_on'

  trigger:
    - platform: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'on'

  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/do_not_disturb
        payload: >-
          { 
          "icon": "exclamation",
          "pushIcon": 0,
          "background": [255,0,0],
          "color": [255,255,255],
          "duration": 60,
          "stack": false,
          "text": "Do Not Disturb"
          }

      ##########################################################
      ## Do Not Disturb Off USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1 Office Do Not Disturb Off
  id: 'desktop_clock_USER1_office_do_not_disturb_off'

  trigger:
    - platform: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'off'

  condition:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/custom/do_not_disturb

        #################################################################
        ## USER2 Left Work USER1's Office Desktop Clock
        #################################################################

- alias: Desktop Clock - USER1's Office USER2 Left
  id: 'desktop_clock_USER1_office_USER2_left_work'

  trigger:
    - platform: state
      entity_id: person.USER2
      from: 'Work'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "cars",
          "pushIcon": 0,
          "duration": 60,
          "textCase": 0,
          "text": "USER2 ETA: {{states('sensor.USER2_to_home')}} mins"
          }

      ##########################################################
      ## USER2 is Home USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office USER2 is Home
  id: 'desktop_clock_USER1_office_USER2_is_home'

  trigger:
    - platform: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_greeting
      state: 'on'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - delay: '00:00:30'
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "house",
          "pushIcon": 0,
          "duration": 30,
          "textCase": 0,
          "rainbow": true,
          "text": "USER2 Home"
          }

      ##########################################################
      ## Washing Machine Done USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Washing Machine Done
  id: 'desktop_clock_USER1_office_washing_machine_done'

  trigger:
    - platform: state
      entity_id: binary_sensor.washer_wash_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "washer",
          "pushIcon": 0,
          "duration": 60,
          "textCase": 0,
          "color": [0,174,255],
          "text": "Washer Finished"
          }

      ##########################################################
      ## Dryer Done USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Dryer Done
  id: 'desktop_clock_USER1_office_dryer_done'

  trigger:
    - platform: state
      entity_id: binary_sensor.dryer_dry_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "dryer",
          "pushIcon": 0,
          "duration": 60,
          "textCase": 0,
          "color": [255,0,0],
          "text": "Dryer Finished"
          }

      ##########################################################
      ## Echo Timer Done USER1's Office Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Echo Timer Done
  id: 'desktop_clock_USER1_office_echo_timer_done'

  mode: parallel
  trigger:
    - platform: state
      entity_id: binary_sensor.USER1_s_office_echo_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.basement_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.bathroom_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.bedroom_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.craft_room_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.dining_room_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.fitness_room_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.guest_bedroom_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.kitchen_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.living_room_timer
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: binary_sensor.USER2_s_office_timer
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "timer",
          "pushIcon": 0,
          "duration": 60,
          "textCase": 0,
          "rainbow": true,
          "text": "Echo Timer Finished"
          }

      ##########################################################
      ## Door Open USER1's Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Door Open
  id: 'desktop_clock_USER1_office_door_open'

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_opened
      from: 'off'
      to: 'on'
    - platform: state
      entity_id: binary_sensor.back_door_opened
      from: 'off'
      to: 'on'
    - platform: state
      entity_id: binary_sensor.basement_door_opened
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "door",
          "pushIcon": 0,
          "duration": 15,
          "textCase": 0,
          "color": [255,0,0],
          "text": "{{ trigger.to_state.attributes.friendly_name }} Opened"
          }

      ##########################################################
      ## Garage Door Open USER1's Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Garage Door Open
  id: 'desktop_clock_USER1_office_garage_door_open'

  trigger:
    - platform: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "garage_open",
          "pushIcon": 0,
          "duration": 30,
          "textCase": 0,
          "color": [255,0,0],
          "text": "Garage Open"
          }

      ##########################################################
      ## Garage Door Closed USER1's Desktop Clock
      ##########################################################

- alias: Desktop Clock - USER1's Office Garage Door Closed
  id: 'desktop_clock_USER1_office_garage_door_closed'

  trigger:
    - platform: state
      entity_id: cover.garage_door
      from: 'open'
      to: 'closed'

  condition:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  action:
    - service: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "garage_close",
          "pushIcon": 0,
          "duration": 30,
          "textCase": 0,
          "color": [0,255,0],
          "text": "Garage Closed"
          }